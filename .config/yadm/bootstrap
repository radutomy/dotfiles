#!/bin/bash

update_system() {
	apt update && apt upgrade -y
	yadm remote set-url origin git@github.com:radutomy/dotfiles.git
}

install_packages() {
	apt remove vim* snap* -y
	apt install wget curl yadm lsb-release bash-completion apt-transport-https tree zip \
		git git-delta tmux lsof sshpass unzip zoxide \
		python3-venv python-is-python3 python3-pip \
		docker.io docker-compose docker-buildx -y
}

install_neovim() {
	# apt install build-essential ripgrep fd-find nodejs npm -y

	# Detect architecture
	ARCH=$(uname -m)
	[[ $ARCH == aarch64 || $ARCH == arm64 ]] && ARCH=arm64 || ARCH=x86_64

	curl -L "https://github.com/neovim/neovim/releases/download/stable/nvim-linux-${ARCH}.appimage" -o /bin/nvim
	chmod +x /bin/nvim
	# nvim --headless "+Lazy! sync" +qa
}

install_fish() {
	apt-add-repository ppa:fish-shell/release-4 -y
	apt install fish fzf fd-find bat lsd -y
	curl -sSfL https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | sh # Install zoxide
	ln -s /usr/bin/batcat /usr/local/bin/bat                                             # https://github.com/sharkdp/bat/issues/982
	fish -c "curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source && fisher update"
	chsh -s $(which fish)
}

install_gpt() {
	# npm install -g @google/gemini-cli
	curl -fsSL https://claude.ai/install.sh | bash
}

cleanup() {
	cd ~
	rm .motd_shown
}

update_system
install_packages
install_neovim
install_gpt
install_fish
cleanup
